# Automatic API documentation using FastAPI and Swagger

This project uses [FastAPI](https://fastapi.tiangolo.com/) to set up REST interfaces for the various services. A benefit of FastAPI is its automatic generation of [Swagger](https://swagger.io/) documentation pages from Python code.

Note that since we use a custom CSS theme, our setup looks like the following:

```python
# FastAPI module for digital_hospitals.xxxx

import importlib.metadata
import digital_hospitals.xxxx

# boolean indicating if the IS_DOCKER environment variable was set (to 1)
from digital_hospitals.common import check_docker

# Get the version number from pyproject.toml
version = importlib.metadata.version('digital_hospitals.xxxx')

api = FastAPI(
    title='XXXX module',
    description=DESCRIPTION,
    version=version,
    docs_url=None,  # Disable default behavior and custom_swagger_ui_html()
    redoc_url=None
)

# API endpoints and supporting functions here

@api.get("/docs", include_in_schema=False)
async def custom_swagger_ui_html():
    IS_DOCKER = check_docker
    root = '/api/xxxx' if IS_DOCKER else ''
    "Serve docs with custom CSS."
    return get_swagger_ui_html(
        openapi_url=f"{root}{api.openapi_url}",
        title=api.title + " - Swagger UI",

        # Our custom CSS is only available in a Docker Compose setting
        swagger_css_url=(
            "/static/swagger-dark-ui.css" if IS_DOCKER
            else "https://cdn.jsdelivr.net/npm/swagger-ui-dist@5.9.0/swagger-ui.css"
        )
    )
```

## Improving upon the default example values

By default, the API examples generated by Swagger gives bad examples, such as "string" for all string values. We can provide better examples using Annotations.

### Example: setting an example for a request field
```python
# A Query() parameter is read from the URL string, e.g., http://example.com?id=abcd.
# See also Body() and Form().

@api.get('/query',
         summary='Query job status',
         description="Get the status/result of a previously submitted request.")
def query(id: Annotated[str,
                        Query(
                            title='Job ID',
                            description='MongoDB object ID as a 24-hex-digit string.',
                            example='665ed486d196679480be839a')],
          db: Annotated[Database, Depends(get_db)]):
```



### Example: setting an example for a response object

```python
# To use this example, construct an @api.post() endpoint that returns this type of object.
class AcceptedResponseModel(pydantic.BaseModel):
    """Schema for an accepted / (root) POST request"""
    detail: Literal['Accepted'] = 'Accepted'
    id: str

    model_config = {
        "json_schema_extra": {
            "examples": [{"detail": "Accepted", "id": '665cf35cd36468e11afb19c5'}]
        }
    }
```
Note that [Pydantic](https://docs.pydantic.dev/latest/api/base_model/#pydantic.BaseModel) is a common Python library for defining data classes and validating JSON input.